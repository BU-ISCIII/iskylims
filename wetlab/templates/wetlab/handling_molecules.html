{% extends "core/base.html" %}
{% load static %}
{% block content %}
{% include "wetlab/menu.html" %}
{% include 'core/jexcel_functionality.html' %}
{% include "core/cdn_table_functionality.html" %}
{% include "wetlab/menu.html" %}
<section class="iskylims d-flex flex-column fill-height">
    <div class="container-md">
        {% include 'registration/login_inline.html' %}
        {% if error_message %}
            <div class="row mt-2 mb-4">
                <div class="col-md-7 offset-3">
                    <div class="card border-danger mb-3">
                        <div class="card-header border-danger"><h3 style="text-align:center">Unable to process your request </h3> </div>
                        <div class="card-body">
                                <h4>{{error_message}}</h4>
                        </div> 
                    </div> 
                </div> 
            </div> 
        {% endif %}
        {% if molecule_protocol %}
            <div class="row my-2">
                <div class="col">
                    <div class="card ">
                        <div class="card-header"><h3>Assign the Molecule Protocol to following samples.</h3></div>
                        <div class="card-body">
                            <form method="post" action= "/wetlab/handlingMolecules" enctype="multipart/form-data" name="updateMoleculeProtocol"  id="updateMoleculeProtocol" class="form-horizontal well">
                                {% csrf_token %}
                                <input type="hidden" name="action" value="updateMoleculeProtocol"/>
                                <input type="hidden" name= "samples" value="{{molecule_protocol.samples}}"/>
                                <input type="hidden" name= "samples_code_ids" value="{{molecule_protocol.sample_code_ids}}"/>

                                <div id="spreadsheet" class="my-3"></div>

                                <input type="button" class="btn btn-outline-secondary my-3" value="Download Spreadsheet" onclick="$('#spreadsheet').jexcel('download')"/>
                                <input class="btn float-end btn-outline-primary my-3" id = "btnSubmit" type="submit" value="Submit">
                            </form>
                        </div>
                        <script>
                            var data = [{% for values in molecule_protocol.data %}
                                [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                            ];
                            dropdownFilter = function(instance, cell, c, r, source) {
                                var value = instance.jexcel.getValueFromCoords(c - 3, r);
                                {% for item, values in molecule_protocol.protocol_filter_selection %}
                                    if (value == '{{item}}') {
                                    return [{% for val in values %}'{{val}}',{% endfor %}];
                                }
                                {% endfor %}

                                else {
                                    return source;
                                }
                            }

                            mySpreadsheet = $('#spreadsheet').jexcel({
                                data:data,
                                columns: [
                                    { type: 'text', title:'{{molecule_protocol.headings.0}}', width:250 , readOnly:true },
                                    { type: 'text', title:'{{molecule_protocol.headings.1}}', width:200 , readOnly:true },
                                    { type: 'dropdown', title:'{{molecule_protocol.headings.2}}', width:150 , source :[ {% for value in molecule_protocol.type_of_molecules %} '{{value}}', {% endfor %}]},
                                    { type: 'dropdown', title:'{{molecule_protocol.headings.3}}', width:150 , source :['Manual', 'Automated']},
                                    { type: 'calendar' , title: '{{molecule_protocol.headings.4}}', width:150 },
                                    { type: 'dropdown', title: '{{molecule_protocol.headings.5}}', width:240 , source:[{% for value in molecule_protocol.protocol_list %}'{{value}}',{% endfor %} ],
                                            filter:dropdownFilter },

                                ],
                                allowInsertColumn:false,
                                allowDeleteColumn:false,
                                allowRenameColumn:false,
                                allowInsertRow:false,
                                allowDeleteRow:false,
                                tableOverflow:true,
                                tableHeight:'200px',
                                csvFileName:'Molecule_data',
                                minDimensions:[{{molecule_protocol.table_length}},{{molecule_protocol.number_of_samples}}],
                                onchange:function(instance, cell, c, r, value) {
                                    if (c == 2) {
                                        var columnName = jexcel.getColumnNameFromId([5, r]);
                                        instance.jexcel.setValue(columnName, '');
                                    }
                                }
                            });

                            $(document).ready(function () {
                                $("#updateMoleculeProtocol").submit(function (e) {
                                    //stop submitting the form to see the disabled button effect
                                    // e.preventDefault();
                                    //disable the submit button
                                    var table_data = $('#spreadsheet').jexcel('getData')
                                    var data_json = JSON.stringify(table_data)
                                    $("<input />").attr("type", "hidden")
                                    .attr("name", "molecule_data")
                                    .attr("value", data_json)
                                    .appendTo("#updateMoleculeProtocol");
                                    $("#btnSubmit").attr("disabled", true);
                                    return true;
                                });
                            });
                        </script>
                    </div>
                </div> 
            </div> 

        {% elif molecule_recorded %}
            {% if molecule_recorded.incomplete_sample_ids %}
                {% if molecule_recorded.heading %}
                    <div class="row my-2">
                        <div class="col-md">
                            <div class="card ">
                                <div class="card-header text-center"><h3>The following molecules are now assigned to Protocol.</h3></div>
                                <div class="card-body">
                                    <table class="table table-hover">
                                        <thead>
                                        <tr>
                                            {% for value in molecule_recorded.heading %}
                                                <th>{{value}}</th>
                                            {% endfor %}
                                        </tr>
                                        </thead>
                                        <tbody>
                                            {% for molecule, protocol in molecule_recorded.molecule_list %}
                                                <tr>
                                                    <td>{{ molecule }} </td>
                                                    <td>{{ protocol }}</td>
                                                </tr>
                                            {%endfor%}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> 
                    </div> 
                {% endif %}
                <div class="row my-2">
                    <div class="col-sm-12">
                        <div class="panel panel-warning">
                            <div class="card-header"><h3>Information missing.</h3></div>
                            <div class="card-body">
                                <br>
                                <p>Please add the missing information and click on the submit bottom</p>
                                <form method="post" enctype="multipart/form-data" name="updateMoleculeProtocol"  id="updateMoleculeProtocol" class="form-horizontal well">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="updateMoleculeProtocol"/>
                                    <input type="hidden" name= "samples" value="{{molecule_recorded.incomplete_sample_ids}}"/>
                                    <input type="hidden" name= "samples_code_ids" value="{{molecule_recorded.incomplete_sample_code_ids}}"/>
                                    <input type="hidden" name= "molecule_code_ids" value="{{molecule_recorded.molecule_code_ids}}"/>
                                    <input type="hidden" name= "molecule_ids" value="{{molecule_recorded.molecule_ids}}"/>
                                    <div id="spreadsheet"></div>
                                    <script>
                                        var data = [{% for values in molecule_recorded.incomplete_sample_data %}
                                            [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                        ];

                                        dropdownFilter = function(instance, cell, c, r, source) {
                                            var value = instance.jexcel.getValueFromCoords(c - 3, r);
                                            {% for item, values in molecule_recorded.protocol_filter_selection %}
                                                if (value == '{{item}}') {
                                                return [{% for val in values %}'{{val}}',{% endfor %}];
                                            }
                                            {% endfor %}

                                            else {
                                                return source;
                                            }
                                        }

                                        mySpreadsheet = $('#spreadsheet').jexcel({
                                            data:data,
                                            columns: [
                                                { type: 'text', title:'{{molecule_recorded.headings.0}}', width:180 , readOnly:true },
                                                { type: 'dropdown', title:'{{molecule_recorded.headings.1}}', width:150 , source :[ {% for value in molecule_recorded.type_of_molecules %} '{{value}}', {% endfor %}]},
                                                { type: 'dropdown', title:'{{molecule_recorded.headings.2}}', width:150 , source :['Manual', 'Automated']},
                                                { type: 'calendar' , title: '{{molecule_recorded.headings.3}}', width:150 },
                                                { type: 'dropdown', title: '{{molecule_recorded.headings.4}}', width:180 , source:[{% for value in molecule_recorded.protocol_list %}'{{value}}',{% endfor %} ],
                                                        filter:dropdownFilter },

                                            ],
                                            allowInsertColumn:false,
                                            allowDeleteColumn:false,
                                            allowRenameColumn:false,
                                            allowInsertRow:false,
                                            allowDeleteRow:false,
                                            tableOverflow:true,
                                            tableHeight:'200px',
                                            csvFileName:'Molecule_data',
                                            minDimensions:[{{molecule_recorded.table_length}},{{molecule_recorded.number_of_samples}}],
                                            onchange:function(instance, cell, c, r, value) {
                                                if (c == 4) {
                                                    var columnName = jexcel.getColumnNameFromId([5, r]);
                                                    instance.jexcel.setValue(columnName, '');
                                                }
                                            }
                                        });
                                    </script>

                                    <input type="button" class="btn btn-outline-secondary" value="Download Spreadsheet" onclick="$('#spreadsheet').jexcel('download')"/>
                                    <input class="btn float-end btn-outline-primary" id = "btnSubmit" type="submit" value="Submit">
                                </form>
                                <script>
                                    $(document).ready(function () {
                                        $("#updateMoleculeProtocol").submit(function (e) {
                                            //stop submitting the form to see the disabled button effect
                                            // e.preventDefault();
                                            //disable the submit button
                                            var table_data = $('#spreadsheet').jexcel('getData')
                                            var data_json = JSON.stringify(table_data)
                                            $("<input />").attr("type", "hidden")
                                            .attr("name", "molecule_data")
                                            .attr("value", data_json)
                                            .appendTo("#updateMoleculeProtocol");
                                            $("#btnSubmit").attr("disabled", true);
                                            return true;
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div> 
                </div> 

            {% else %}

                {% if show_molecule_parameters %}
                    {% if not show_molecule_parameters.lot_kit %}
                        <div class="row my-2">
                            <div class="col-sm-10 offset-1">
                                <div class="card border-danger mb-3">
                                    <div class="card-header"><h3>Not Available User Lot Kits.</h3></div>
                                    <div class="card-body">
                                        <p>There is not User Lot Kit defined on your name.</p>
                                        <p class="mb-3">Click on the bottom below to define your Lot Kit first. Then return again to assign the molecule parameter</p>
                                        <button type="button" class="btn btn-outline-primary float-end" onclick="location.href = '/wetlab/addUserLotCommercialKit';">Define new User Lot Commercial Kit</button>
                                    </div>
                                </div>
                            </div>
                        </div> 
                    {% endif %}
                    <div class="row my-2">
                        <div class="col-sm-12">
                            <div class="card ">
                                <div class="card-header"><h3>Update the following molecules with quality parameters.</h3></div>
                                <div class="card-body">
                                    {% if show_molecule_parameters.pending_id %}
                                        <p>The selected molecules contain different protocol</p>
                                        <p>After Clicking the Submit buttom the next molecules will be displayed</p>
                                    {% endif %}
                                    <form method="post" enctype="multipart/form-data" name="addMoleculeParameters"  id="addMoleculeParameters" class="form-horizontal well">
                                        {% csrf_token %}
                                        <input type="hidden" name="action" value="addMoleculeParameters"/>
                                        <input type="hidden" name= "molecules" value="{{show_molecule_parameters.molecule_id}}"/>
                                        <input type="hidden" name= "heading_in_excel" value="{{show_molecule_parameters.heading_in_excel}}"/>
                                        <input type="hidden" name= "molecule_code_ids" value="{{show_molecule_parameters.molecule_code_ids}}"/>
                                        {% if show_molecule_parameters.pending_id %}
                                            <input type="hidden" name= "pending" value="{{show_molecule_parameters.pending_id}}"/>
                                        {% endif %}
                                        <div class="row horizontal-scroll my-3">
                                            <div id="spreadsheet"></div>
                                        </div> 
                                        <script>
                                            var data = [{% for values in show_molecule_parameters.data %}
                                                [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                            ];

                                            mySpreadsheet = $('#spreadsheet').jexcel({
                                                data:data,
                                                columns: [
                                                        { type: 'text', title:'{{show_molecule_parameters.fix_heading.0}}', width:180 , readOnly:true },
                                                        { type: 'dropdown', title:'{{show_molecule_parameters.fix_heading.1}}', width:180 , source:[{% for value in show_molecule_parameters.lot_kit %}'{{value}}',{% endfor %} ]},

                                                        {% for name, type, options in show_molecule_parameters.protocol_parameters_heading_type %}
                                                            {% if type == 'Date' %}
                                                                { type: 'calendar', title:'{{name}}', width:150 },
                                                            {% elif type == 'Option List'%}
                                                                { type: 'dropdown', title:'{{name}}', width:150 , source: [{% for value in options %}"{{value}}",{% endfor %}] },
                                                            {% else %}
                                                                { type: 'text', title:'{{name}}', width:150 },
                                                            {% endif %}
                                                        {% endfor %}
                                                ],
                                                allowInsertColumn:false,
                                                allowDeleteColumn:false,
                                                allowRenameColumn:false,
                                                allowInsertRow:false,
                                                allowDeleteRow:false,
                                                tableOverflow:false,
                                                tableHeight:'600px',
                                                csvFileName:'quality_data',
                                            });
                                        </script>

                                        <input type="button" class="btn btn-outline-secondary" value="Return Home" onclick="location.href ='/wetlab' ;"/>
                                        <input class="btn float-end btn-outline-primary" id = "btnSubmit" type="submit" value="Submit">
                                    </form>
                                    <script>
                                        $(document).ready(function () {
                                            $("#addMoleculeParameters").submit(function (e) {
                                                //stop submitting the form to see the disabled button effect
                                                // e.preventDefault();
                                                //disable the submit button
                                                var empty_value = 0
                                                var table_data = $('#spreadsheet').jexcel('getData')
                                                table_data.forEach((row, index)=>{
                                                    if (row[1] == ''){
                                                        empty_value +=1
                                                        }
                                                });
                                                if (empty_value > 0){
                                                    window.alert("Please fill the empty Lot Kit ");
                                                    return false;
                                                }
                                                else{
                                                    var data_json = JSON.stringify(table_data)

                                                    $("<input />").attr("type", "hidden")
                                                        .attr("name", "parameters_data")
                                                        .attr("value", data_json)
                                                        .appendTo("#addMoleculeParameters");
                                                    $("#btnSubmit").attr("disabled", true);
                                                    return true;
                                                }
                                            });
                                        });
                                    </script>
                                </div>
                            </div>
                        </div> 
                    </div> 
                {% endif %}
            {% endif %}

        {% elif molecule_parameters_updated  %}
            <div class="row my-2">
                <div class="col-sm-12">
                    <div class="card ">
                        <div class="card-header"><h3>The following molecules have been updated with quality Parameters.</h3></div>
                        <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Molecule Code ID</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for values in molecule_parameters_updated %}
                                <tr>
                                <td>{{ values }} </td>
                                </tr>
                            {%endfor%}
                                </tbody>
                        </table>
                    </div>
                </div>

            </div> <!--  end of col-sm-12 -->
        </div> <!--  end of row -->
        {% if show_molecule_parameters %}
                <div class="row my-2">
                <div class="col-sm-12">
                    <div class="card ">
                        <div class="card-header"><h3>Update the following molecules with Nucleic quality Parameters.</h3></div>
                        <div class="card-body">
                            {% if show_molecule_parameters.pending_id %}
                                <p>The selected molecules contain different protocol</p>
                                <p>After Clicking ----- the Submit buttom the next molecules will be displayed</p>
                            {% endif %}
                            <form method="post" enctype="multipart/form-data" name="addMoleculeParameters"  id="addMoleculeParameters" class="form-horizontal well">
                                {% csrf_token %}
                                <div class="scrolling-wrapper">
                                <input type="hidden" name="action" value="addMoleculeParameters"/>
                                <input type="hidden" name= "molecules" value="{{show_molecule_parameters.molecule_id}}"/>
                                <input type="hidden" name= "heading_in_excel" value="{{show_molecule_parameters.heading_in_excel}}"/>
                                <input type="hidden" name= "molecule_code_ids" value="{{show_molecule_parameters.molecule_code_ids}}"/>
                                {% if show_molecule_parameters.pending_id %}
                                        <input type="hidden" name= "pending" value="{{show_molecule_parameters.pending_id}}"/>
                                {% endif %}

                                    <div id="spreadsheet"></div>
                                </div> <!--  end of scrolling  -->
                                <script>
                                    var data = [{% for values in show_molecule_parameters.data %}
                                        [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                    ];

                                    mySpreadsheet = $('#spreadsheet').jexcel({
                                        data:data,
                                        columns: [
                                                    { type: 'text', title:'{{show_molecule_parameters.fix_heading.0}}', width:180 , readOnly:true },
                                                    { type: 'dropdown', title:'{{show_molecule_parameters.fix_heading.1}}', width:180 , source:[{% for value in show_molecule_parameters.lot_kit %}'{{value}}',{% endfor %} ]},

                                                    {% for name, type, options in show_molecule_parameters.protocol_parameters_heading_type %}
                                                        {% if type == 'Date' %}
                                                            { type: 'calendar', title:'{{name}}', width:150 },
                                                        {% elif type == 'Option List'%}
                                                            { type: 'dropdown', title:'{{name}}', width:150 , source: [{% for value in options %}"{{value}}",{% endfor %}] },
                                                        {% else %}
                                                            { type: 'text', title:'{{name}}', width:150 },
                                                        {% endif %}
                                                    {% endfor %}
                                        ],
                                        allowInsertColumn:false,
                                        allowDeleteColumn:false,
                                        allowRenameColumn:false,
                                        allowInsertRow:false,
                                        allowDeleteRow:false,
                                        tableOverflow:false,
                                        tableHeight:'200px',
                                        csvFileName:'quality_data',

                                    });
                                </script>
                                <input type="button" class="btn btn-outline-secondary" value="Return Home" onclick="location.href ='/wetlab' ;"/>
                                <input class="btn float-end btn-outline-primary" id = "btnSubmit" type="submit" value="Submit">

                            </form>
                            <script>
                                $(document).ready(function () {
                                    $("#addMoleculeParameters").submit(function (e) {
                                        //stop submitting the form to see the disabled button effect
                                        // e.preventDefault();
                                        //disable the submit button
                                        var table_data = $('#spreadsheet').jexcel('getData')
                                        var data_json = JSON.stringify(table_data)
                                        $("<input />").attr("type", "hidden")
                                            .attr("name", "parameters_data")
                                            .attr("value", data_json)
                                            .appendTo("#addMoleculeParameters");
                                        $("#btnSubmit").attr("disabled", true);
                                        return true;
                                    });
                                });
                            </script>
                        </div>
                    </div>

                </div> <!--  end of col-sm-12 -->
                </div> <!--  end of row -->
        {%endif %}

        {% elif molecule_use %}
            <div class="row my-2">
                <div class="col-sm-12">
                    <div class="card ">
                        <div class="card-header"><h3>Molecule uses updated.</h3></div>
                        <div class="card-body">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    {% for value in molecule_use.heading %}
                                        <th>{{value}}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                    {% for values in molecule_use.data %}
                                        <tr>
                                            {% for value in values %}
                                                <td>{{ value }} </td>
                                            {% endfor %}
                                        </tr>
                                    {%endfor%}
                                </tbody>
                        </table>
                    </div>
                </div>
            </div> <!--  end of col-sm-12 -->
            </div> <!--  end of row -->

        {% else %}
            <div class="row my-2">
                <div class="col">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="n_samples-tab" data-bs-toggle="tab" data-bs-target="#n_samples" type="button" role="tab" aria-controls="n_samples" aria-selected="true">New Samples</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="molecule-tab" data-bs-toggle="tab" data-bs-target="#molecule" type="button" role="tab" aria-controls="molecule" aria-selected="false">My pending molecules</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mol_use-tab" data-bs-toggle="tab" data-bs-target="#mol_use" type="button" role="tab" aria-controls="mol_use" aria-selected="false">Molecules use specification</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="n_samples" role="tabpanel" aria-labelledby="n_samples-tab">
                            <div class="container">
                                <div class="row mt-4">
                                    <div class="col-md">
                                        <div class="card">
                                            <div class="card-header"><h3 style="text-align:center">Select the molecules to add Extraction information</h3></div>
                                            <div class="card-body">
                                                {% if user_molecules %}
                                                    <form method="post" action="/wetlab/handlingMolecules" enctype="multipart/form-data" name="selectedOwnerMolecules"  id="selectedOwnerMolecules">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="action" value="selectedOwnerMolecules"/>
                                                        <input type="hidden" name="samples_in_list" value="True"/>
                                                        <table id="cdn_table" class="table table-striped table-bordered ">
                                                            <thead>
                                                                <tr>
                                                                    {% for value in user_molecules.molecule_heading %}
                                                                        <th> {{ value }}</th>
                                                                    {% endfor %}
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {% for s_name , code, date, protocol,  m_id  in user_molecules.data  %}
                                                                    <tr>
                                                                        <td>{{s_name}}</td>
                                                                        <td>{{code}}</td>
                                                                        <td>{{date}}</td>
                                                                        <td>{{protocol}}</td>
                                                                        <td><input type="checkbox" name="molecules" value="{{m_id}}"></td>
                                                                    </tr>
                                                                {% endfor %}
                                                            </tbody>
                                                        </table>
                                                        <input type="button" class="btn btn-outline-secondary my-3"  value="Return Home" onclick="location.href ='/wetlab' ;"/>
                                                        <input class="btn float-end btn-outline-primary my-3" type="submit" value="Submit">
                                                    </form>
                                                {% else %}
                                                    <h4> Your pending  molecule list is empty </h4>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                            </div>
                        </div> <!-- // end of tab n_samples -->
                        <div class="tab-pane fade" id="molecule" role="tabpanel" aria-labelledby="molecule-tab">
                            <div class="container">
                                <div class="row mt-4">
                                    <div class="col">
                                        <div class="card">
                                            <div class="card-header"><h3 style="text-align:center">Select the Samples to add Molecule information</h3></div>
                                            <div class="card-body">
                                                {% if sample_availables.sample_heading %}
                                                    <form method="post" action="/wetlab/handlingMolecules" enctype="multipart/form-data" name="selectedMolecules"  id="selectedMolecules" class="form-horizontal well">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="action" value="selectedMolecules"/>
                                                        <input type="hidden" name="samples_in_list" value="True"/>
                                                            <div class="col-md-12 my-3 horizontal-scroll">
                                                                
                                                                <div id="spreadsheet1" ></div>
                                                            <script>
                                                                var data1 = [{% for values in sample_availables.sample_information %}
                                                                    [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                                                ];
                                                                var table1 = jexcel(document.getElementById('spreadsheet1'), {
                                                                    data:data1,
                                                                    columns: [{% for values in sample_availables.sample_heading  %}
                                                                        {% if forloop.last %}
                                                                            { type: 'hidden' },
                                                                            { type: 'checkbox',  title:'{{values}}', width:150 },
                                                                        {% else %}
                                                                            { type: 'text', title:'{{values}}', width:300 , readOnly:true },
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                    ],

                                                                    allowInsertColumn:false,
                                                                    allowDeleteColumn:false,
                                                                    allowRenameColumn:false,
                                                                    allowInsertRow:false,
                                                                    allowDeleteRow:false,
                                                                    tableOverflow:false,
                                                                    search:true,
                                                                    pagination:20,
                                                                    csvFileName:'SamplesDefined.csv',

                                                                });
                                                            </script>
                                                            <script>
                                                                $(document).ready(function () {
                                                                    $("#selectedMolecules").submit(function (e) {
                                                                        //stop submitting the form to see the disabled button effect
                                                                        // e.preventDefault();
                                                                        //disable the submit button
                                                                        var table_data = table1.getData()
                                                                        var data_json = JSON.stringify(table_data)
                                                                        $("<input />").attr("type", "hidden")
                                                                        .attr("name", "selected_samples")
                                                                        .attr("value", data_json)
                                                                        .appendTo("#selectedMolecules");
                                                                        $("#btnSubmit").attr("disabled", true);
                                                                        return true;
                                                                    });
                                                                });
                                                            </script>
                                                        </div>
                                                        <div class="col">
                                                            <input class="btn btn-outline-secondary" type="button" value="Return Home" onclick="location.href ='/wetlab' ;"/>
                                                            <input class="btn float-end btn-outline-primary" type="submit" value="Submit">
                                                        </div>
                                                    </form>
                                            
                                                {% else %}
                                                        <h4>There is no samples to add Molecule Extraction information</h4>
                                                    
                                                {% endif %}
                                            </div>  
                                        </div>  
                                    </div>
                                </div>
                            </div> 
                        </div> <!-- end of tab molecule -->
                        <div class="tab-pane fade" id="mol_use" role="tabpanel" aria-labelledby="mol_use-tab">
                            <div class="container">
                                <div class="row mt-4">
                                    <div class="col">
                                        <div class="card">
                                            <div class="card-header"><h3 style="text-align:center">Select in these samples the use that will be given of them</h3></div>
                                            <div class="card-body">
                                                {% if molecule_use_defined %}
                                                    {% if request_molecule_use.heading %}
                                                        <form method="post" action="/wetlab/handlingMolecules" enctype="multipart/form-data" name="requestMoleculeUse"  id="requestMoleculeUse" class="form-horizontal well">
                                                            {% csrf_token %}
                                                            <input type="hidden" name="action" value="requestMoleculeUse"/>
                                                            <input type="hidden" name="molecule_in_list" value="False"/>
                                                            <input type="hidden" name="molecule_ids" value="{{request_molecule_use.molecule_ids}}"/>
                                                            <input type="hidden" name="molecule_code_ids" value="{{request_molecule_use.molecule_code_ids}}"/>
                                                                <div id="spreadsheet2" class="mb-4"></div>
                                                                <script>
                                                                    var data2 = [{% for values in request_molecule_use.data %}
                                                                        [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                                                    ];

                                                                    var table2  = jexcel(document.getElementById('spreadsheet2'), {
                                                                        data:data2,
                                                                        columns: [
                                                                                { type: 'text', title:'{{request_molecule_use.heading.0}}', width:220 , readOnly:true },
                                                                                { type: 'text', title:'{{request_molecule_use.heading.1}}', width:280 , readOnly:true },
                                                                                { type: 'dropdown', title:'{{request_molecule_use.heading.2}}', width:220 , source:[{% for value in request_molecule_use.types %}'{{value}}',{% endfor %} ]},
                                                                    ],
                                                                        allowInsertColumn:false,
                                                                        allowDeleteColumn:false,
                                                                        allowRenameColumn:false,
                                                                        allowInsertRow:false,
                                                                        allowDeleteRow:false,
                                                                        tableOverflow:true,
                                                                        search:true,
                                                                        pagination:20,
                                                                        csvFileName:'molecule_use',
                                                                    });
                                                                </script>
                                                                <input type="button" value="Return Home" onclick="location.href ='/wetlab' ;"/>
                                                                <input class="btn float-end btn-outline-primary" id="btnSubmit" type="submit" value="Submit">
                                                            </div>
                                                        </form>
                                                        <script>
                                                            $(document).ready(function () {
                                                                $("#requestMoleculeUse").submit(function (e) {
                                                                    //stop submitting the form to see the disabled button effect
                                                                    // e.preventDefault();
                                                                    //disable the submit button
                                                                    var table_data2 = table2.getData()
                                                                    var data_json = JSON.stringify(table_data2)
                                                                    $("<input />").attr("type", "hidden")
                                                                        .attr("name", "molecule_used_for")
                                                                        .attr("value", data_json)
                                                                        .appendTo("#requestMoleculeUse");
                                                                    $("#btnSubmit").attr("disabled", true);
                                                                    return true;
                                                                });
                                                            });
                                                        </script>
                                                    {% else %}
                                                        <h4>All Molecule extraction have already assigned to an use</h4>
                                                    {% endif %}
                                                {% else %}
                                                    <h4>Not molecule uses have been defined yet</h4>
                                                {% endif %}
                                            </div> 
                                        </div>  
                                    </div>
                                </div>
                            </div>
                        </div> <!-- // end of tab mole_use -->
                    </div>
                </div> 
            </div> 
        {% endif %}
    </div>
</section>
<script type="text/javascript">
    $(document).ready(function() {
        $('#cdn_table').DataTable({
            responsive: true,
        });
    });
</script>
{% endblock %}
